<!DOCTYPE HTML>
<html>
  <head>
    <title>Homepage</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
     .navbar-default {
         background-color: #312450;
         border: 0px solid white;
     }

     @media (max-width: 768px) {
         nav .container-fluid {
            margin-left: 0px;
            padding-left: 0px;

         }
     }

     .navbar-nav {
         margin-left: auto;
         margin-right: auto;
         width: 365px;
         float: none;
         margin-bottom: 0px;
     }

     .navbar-nav ul {
         margin-top: 14px;
     }

     .navbar-nav>li {
         float: left;
     }

     .navbar-default .navbar-nav > li >a {
         color: rgba(255,255,255,.55);
     }

     .navbar-default .navbar-nav >.active >a,
     .navbar-default .navbar-nav >.active >a:focus,
     .navbar-default .navbar-nav >.active >a:hover {
         color: white;
         background-color: #312450;
     }

     .navbar-default .navbar-nav > li > a:focus,
     .navbar-default .navbar-nav > li > a:hover,
     .navbar-default .navbar-nav > li > a:active,
     .navbar-default .navbar-nav > li > a.active
     {
         color: white;
         background-color: #312450;
         border-bottom: 2px solid #b74e91;

     }

     #container-center {
         margin-top: 60px;
     }

     body {
         background-color: #5E42A6;
     }

     a {
         color: white;
     }

     #container-center a {
         color: white;
         border-bottom: dotted 1px rgba(255,255,255,.35);
         transition: color .2s ease,border-bottom-color .2s ease;
     }

     #reddit .row {
         padding-left: 20px;
     }

     td {
         display: inline-table;
         margin-top: 10px;
     }

     h1 {
         text-transform: capitalize;
     }

     tbody tr td a:nth-child(3) {
         padding-left: 10px;
         border-bottom: dotted 0px white !important;
         color: rgba(255,255,255,.55) !important;
     }

     body {
         overflow-x: hidden;
     }

    /* -------------------------------------
    * VIDEO
    * -------------------------------------
    */

    .videoItem .header {
        height: 10%;
        text-align: center;
    }

    .videoItem .thumbnail {
        height: 70%;
        padding: 5px;
        background-color: #312450;
        border: none;
    }

    .videoItem img {
        height:100%;
        width: 100%;
    }

    .videoItem .footer {
        height: 20%;
        text-align: center;
    }

    /* -------------------------------------
    * Serie
    * -------------------------------------
    */

    .serie-item header {
        height: 10%;
        text-align: center;
    }

    .serie-item footer {
        height: 20%;
        text-align: center;
    }

    .serie-item img {
        height:100%;
        width: 100%;
    }
    .serie-item .thumbnail {
        height: 70%;
        padding: 5px;
        background-color: #312450;
        border: none;
    }

    </style>
  </head>
  <body>
      <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container-fluid">
                  <div>
                      <ul class="nav navbar-nav">
                        <li>
                            <a href="" class="active"">Youtube</a>
                        </li>
                        <li>
                            <a href="">SÃ©ries</a>
                        </li>
                        <li>
                            <a href="">Anime</a>
                        </li>
                        <li>
                            <a href="">Reddit</a>
                        </li>
                        <li>
                            <a href="">Twitter</a>
                        </li>
                    </ul>
                  </div>

          </div>
      </nav>

      <div class="container-fluid" id="container-center">
          <div id="youtube" class="row">

          </div>
          <div id="series" class="row">

          </div>
          <div id="anime" class="row">

          </div>
          <div id="reddit" class="row">

          </div>
          <div id="twitter" class="row">

          </div>
      </div>




      <script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
      <script>
        'use strict';

        function generateVideoView(channelName, video)
        {
            var container = $('<div>', {'class': 'item videoItem col-sm-6 col-md-2'});
            var header = $('<div class="header">' +
                            '<a href="">' +
                                '<h4>' + channelName + '</h4>' +
                            '</a>' +
                            '</div>'
                        );

            var thumbnail = $('<div class="thumbnail">' +
                            '<a href="' + video.url + '">' +
                                '<img src="' + video.thumbnail + '"/>' +
                            '</a>' +
                            '</div>'
                            );

            var footer = $('<div class="footer">' +
                            '<a href="' + video.url + '">' +  video.title + '</a>' +
                        '</div>'
                        );


            header.click(function(event) {
                event.preventDefault();
                $.getJSON("/api/youtube/get/" + encodeURIComponent(channelName),
                        prepareVideos.bind(undefined, openPanel(channelName)));
            });


            return container.append(header, thumbnail, footer);
        }

        function generateSerieView(serie, episode)
        {
            var container = $("<div>", {'class': 'item serie-item col-md-2 col-sm-6'});
            var header = $('<header>' +
                        '<a href=""><h4>' + serie.name + '</h4></a>' +
                        '</header>');

            var thumbnail = $('<div class="thumbnail">' +
                                '<a href="' + episode.magnetURI + '">' +
                                '<img src="' + serie.thumbnail + '" /></a>' +
                            '</div>'
                            );

            var date = new Date(episode.date * 1000);
            var footer = $('<footer class="footer">' +
                                '<a href="' + episode.magnetURI + '">' +
                                    '<a>' + episode.title + '</a><br/>' +
                                    '<a>' + date.toLocaleDateString() + '</a>' +
                                '</a>' +
                            '</footer>'
                        );


            header.click(function(event) {
                event.preventDefault();
                $.getJSON("/api/serie/get/" + encodeURIComponent(serie.name),
                        prepareSeries.bind(undefined, openPanel(serie.name)));
            });


            return container.append(header, thumbnail, footer);

        }

        function prepareVideos(container, json)
        {
            var videos = json.filter(function(channel) { return channel.videos.length; } )
                            .map(function(channel) {
                                return channel.videos.map(function(video) {
                                    return generateVideoView(channel.name, video);
                                });
                            });

            var dom = [];
            $.each(videos, function(ix, el ) {
                var i = Math.floor(ix / 6);
                if(dom[i] === undefined) {
                    dom[i] = $("<div>", {"class" : "row"});
                }
                dom[i].append(el);

            });

            container.append.apply(container, dom);

        }

        function prepareSeries(container, json)
        {
            var series = json.filter(function(serie) { return serie.episodes.length; } )
                            .sort(function(a,b) { return b.episodes[0].date - a.episodes[0].date;} )
                            .map(function(serie) {
                                return serie.episodes.map(function(episode) {
                                    return generateSerieView (serie, episode);

                                });
                            });
            var dom = [];
            $.each(series, function(ix, el ) {
                var i = Math.floor(ix / 6);
                if(dom[i] === undefined) {
                    dom[i] = $("<div>", {"class" : "row"});
                }
                dom[i].append(el);

            });
            container.append.apply(container, dom);
        }

        function prepareReddit(container, json)
        {
            var subs = json.filter(function(sub) { return sub.topics.length; } )
                        .map(function(sub) {
                            var table = $("<table class='item reddit-item col-md-6 col-sm-12'><thead ><tr><th>"
                                            + "<h1><a href='https://reddit.com/r/" + sub.name + "'>"+ sub.name +"</a></h1>"
                                        + "</th></tr></thead><tbody></tbody></table>"
                                            );
                                return table.append.apply(table, sub.topics.map(function(topic) {
                                    return generateRedditView(sub.name, topic); }));
                            });

            var dom = [];
            $.each(subs, function(ix, el ) {
                var i = Math.floor(ix / 2);
                if(dom[i] === undefined) {
                    dom[i] = $("<div>", {"class" : "row"});
                }
                dom[i].append(el);

            });

            container.append.apply(container, dom);

        }

        function generateRedditView(subName, topic)
        {
            var generateThumbnail = function(topic) {
                var url = topic.thumbnail;
                return (url.length && url != "self") ?
                    '<a href="'+ topic.url + '"><img style="vertical-align: middle;" src="' + url  + '"/></a>'
                    : "";
            };


            var row = $('<tr>');
            var cell = $('<td>');
            var row_bullet = $('<td>', {"class": "bullet", html: generateThumbnail(topic)});
            var link = $('<a href="' + topic.url + '"><b>'+ topic.title + '</b></a>' +
                '<br/><a style="font-size:12px;" href="'+ topic.commentLink + '"> ' + topic.numComments + ' comments </a>');

            cell.append(link);
            return row.append.apply(row, [row_bullet, cell]);
        }

        jQuery(document).ready(function($) {
            $.getJSON("/api/youtube/last",  prepareVideos.bind(null, $("#youtube")));
            $.getJSON("/api/serie/last",    prepareSeries.bind(null, $("#series")));
            $.getJSON("/api/reddit/last",   prepareReddit.bind(null, $("#reddit ")));

            $("#container-center > div").hide();
            $("#container-center > div:nth-child(1)").show();


            $(document).keydown(function(ev) {
                switch(ev.which) {
                    case 37: // left
                        var op = (-1);
                        break;

                    case 39: // right
                        var op = (+1);
                        break;

                    default: return;
                }
                var len = $("nav ul li a").length;
                var pos = $("nav ul li a").index($("nav ul li a[class*='active']"));
                pos = 1 + ((pos + op) % len);
                $("nav ul li a").removeClass("active");
                $("nav ul li:nth-child(" + pos + ") a").addClass("active");
                $("#container-center > div").hide();
                $("#container-center > div:nth-child(" + pos + ")").show();
                ev.preventDefault();
            });

            $("nav ul li a").on("click", function(ev) {
                $("nav ul li a").removeClass("active");
                $(ev.target).addClass("active");

                var len = $("nav ul li a").length;
                var pos = $("nav ul li a").index($("nav ul li a[class*='active']")) + 1;
                $("#container-center > div").hide();
                $("#container-center > div:nth-child(" + pos + ")").show();
                ev.preventDefault();

            });
        });

      </script>
  </body>
</html>
